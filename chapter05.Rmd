---
title       : Barplots
description : Generate and examine barplots displaying one categorical variable or relationships between multiple categorical variables via the ggplot2 package using datasets in and derived from the fivethirtyeight R package
  
--- type:NormalExercise lang:r xp:100 skills:1
## Distribution of one categorical variable

When working with a qualitative variable (one in which the data falls into many different categories), the first plot you will likely make is a barplot.  This will show how many of each category there are for that particular categorical variable.

Recall the `bechdel` data frame that was introduced earlier in the course from the `fivethirtyeight` R package.  Suppose we are interested in analyzing the distribution of the `clean_test` variable.  

Observe **The Bechdel Test Over Time** image in the article ["The Dollar-And-Cents Case Against Hollywood’s Exclusion of Women"](https://fivethirtyeight.com/features/the-dollar-and-cents-case-against-hollywoods-exclusion-of-women/).  You can use this to get a better idea as to what the categories of `clean_test` represent.

To assist with the plotting, the `clean_test` variable has been converted to a `factor` with `levels` set corresponding to the order given in the plot in the article.

*** =instructions
- Produce an appropriate plot looking at the distribution of `clean_test` in the `bechdel` data frame.
- THINK ABOUT IT:  What does this plot tell us in terms of movies passing the Bechdel test or not since 1970?

*** =hint
- Remember that we use the `aes` function to map aesthetics.  Also be sure there are two `))` before the `+`:  one for the `ggplot` call and one for the `aes` call.
- Barplots are created using `geom_bar` when we want to determine the total number in each category from a data set.

*** =pre_exercise_code
```{r}
library(fivethirtyeight)
data(bechdel)
```

*** =sample_code
```{r}
library(fivethirtyeight)
library(ggplot2)
# Convert to factor
bechdel$clean_test <- factor(bechdel$clean_test,
    levels = c("nowomen", "notalk", "men", "dubious", "ok"))

# Produce an appropriate plot by filling in the entries correctly
ggplot(data = ,
       mapping = aes(   ) +
  geom_   ()
```

*** =solution
```{r}
library(fivethirtyeight)
library(ggplot2)

# Produce an appropriate plot by filling in the entries correctly below
ggplot(data = bechdel,
       mapping = aes(x = clean_test)) +
  geom_bar()
```

*** =sct
```{r}
test_library_function("ggplot2")
test_ggplot(check_data = TRUE, check_aes = TRUE, check_geom = TRUE)

test_error()
```

--- type:NormalExercise lang:r xp:100 skills:1
## Distribution of another categorical variable

The plot in the previous exercise is a little deceiving since it appears that `ok` stands above the other categories.  There is a different variable in `bechdel` that better shows whether a movie passed or failed the `bechdel` test.

*** =instructions
- Use the `glimpse` function on `bechdel` to identify this more appropriate variable. (Recall that you can test code in the Console first, then enter it into the script window.)
- Produce a barplot of this variable and also `fill` based on the different values of the variable.

*** =hint
- Remember to load the `tibble` package in order to use `glimpse`.
- Barplots are created using `geom_bar` when we want to determine the total number in each category from a data set.
- Note the location of `fill = ` here inside the `aes` function.

*** =pre_exercise_code
```{r}
library(fivethirtyeight)
data(bechdel)
bechdel$clean_test <- factor(bechdel$clean_test,
    levels = c("nowomen", "notalk", "men", "dubious", "ok"))
```

*** =sample_code
```{r}
library(fivethirtyeight)

# Identify the variable that gives pass/fail of the Bechdel test
library( )


# Produce an appropriate plot by filling in the entries correctly
library(ggplot2)
ggplot(data = ,
       mapping = aes(   , fill = ) +
  geom_   ()
```

*** =solution
```{r}
# Identify the variable that gives pass/fail of the Bechdel test
library(tibble)
glimpse(bechdel)

# Produce an appropriate plot by filling in the entries correctly below
library(ggplot2)
ggplot(data = bechdel,
       mapping = aes(x = binary, fill = binary)) +
  geom_bar()
```

*** =sct
```{r}
test_library_function("ggplot2")
test_ggplot(check_data = TRUE, check_aes = TRUE, check_geom = TRUE)

test_error()
```

--- type:NormalExercise lang:r xp:100 skills:1
## Movies over time

The **The Bechdel Test Over Time** image in the article ["The Dollar-And-Cents Case Against Hollywood’s Exclusion of Women"](https://fivethirtyeight.com/features/the-dollar-and-cents-case-against-hollywoods-exclusion-of-women/) breaks down the distribution of `clean_test` across five year intervals from 1970 to 2014 (1970-'74, 1975-'79, etc.).  Technically, the last interval only contains four years: 2010-'13.

A new variable called `five_year` has been added to the `bechdel` data frame that shows which five-year time interval each of the movies there falls within.  This new variable in addition to the other variables in the `bechdel` data frame can be viewed interactively [here](https://ismayc.github.io/Effective-Data-Storytelling-using-the-tidyverse/bechdel_five_year.html).

*** =instructions
- Produce a barplot showing the counts of the number of movies in each  of the different `five_year` increments.

*** =hint
- Barplots are created using `geom_bar` when we want to determine the total number in each category from a data set.

*** =pre_exercise_code
```{r}
library(fivethirtyeight)
library(dplyr)
data(bechdel)
year_bins <- c("1970-'74", "1975-'79", "1980-'84", "1985-'89",
               "1990-'94", "1995-'99", "2000-'04", "2005-'09",
               "2010-'13")
bechdel <- bechdel %>%
  mutate(five_year = cut(year, 
                         breaks = seq(1969, 2014, 5), 
                         labels = year_bins))
```

*** =sample_code
```{r}
library(fivethirtyeight)
library(ggplot2)

```

*** =solution
```{r}
library(fivethirtyeight)
library(ggplot2)
ggplot(data = bechdel,
       mapping = aes(x = five_year)) +
  geom_bar()
```

*** =sct
```{r}
test_library_function("ggplot2")
test_ggplot(check_data = TRUE, check_aes = TRUE, check_geom = TRUE)

test_error()
```

--- type:NormalExercise lang:r xp:100 skills:1
## Bechdel pass/fail over time

We can now look at the relationship of movies passing or failing the Bechdel test based on the `five_year` time periods.  In other words, we will be "painting" the bars you created in the previous exercise proportionally based on the number that `FAIL` or `PASS`.  The plot from the previous exercise has been added here.

*** =instructions
- Produce a barplot showing the counts of the number of movies in each of the different `five_year` increments `fill`ed according to the levels of `binary`.

*** =hint
- Barplots are created using `geom_bar` when we want to determine the total number in each category from a data set.
- To change the colors of the bars based on another variable (say `var2`), include `fill = var2` inside of `aes`.  Note that `var2` is just a general variable and not one actually in `bechdel`.

*** =pre_exercise_code
```{r}
library(fivethirtyeight)
library(dplyr)
data(bechdel)
year_bins <- c("1970-'74", "1975-'79", "1980-'84", "1985-'89",
               "1990-'94", "1995-'99", "2000-'04", "2005-'09",
               "2010-'13")
bechdel <- bechdel %>%
  mutate(five_year = cut(year, 
                         breaks = seq(1969, 2014, 5), 
                         labels = year_bins))
ggplot(data = bechdel,
       mapping = aes(x = five_year)) +
  geom_bar()
```

*** =sample_code
```{r}
library(fivethirtyeight)
library(ggplot2)

```

*** =solution
```{r}
library(fivethirtyeight)
library(ggplot2)
ggplot(data = bechdel,
       mapping = aes(x = five_year, fill = binary)) +
  geom_bar()
```

*** =sct
```{r}
test_library_function("ggplot2")
test_ggplot(check_data = TRUE, check_aes = TRUE, check_geom = TRUE)

test_error()
```
